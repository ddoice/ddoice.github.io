<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
</head>
<style>
  body {
    margin: 0;
    padding: 0;
  }
  .title {
    position: fixed;
    top: 0;
    left: 10px;
    font-family: sans-serif;
    font-size: 18px;
  }
</style>

<h1 class="title">Boarding pass scan (beta) v.1.2</h1>
<video id="stream" style="width: 100vw; height: 100vh;" />

<script src="//cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>

<script>

const main = async () => { 
  
const stream = await navigator.mediaDevices.getUserMedia({
  video: {
    facingMode: {
      ideal: "environment"
    }
  },
  audio: false
});
  
const videoEl = document.querySelector("#stream");
videoEl.srcObject = stream;
await videoEl.play();

const barcodeDetector = new BarcodeDetector({formats: ['pdf417','qr_code']});
const vamos = async () => {
  const barcodes = await barcodeDetector.detect(videoEl);
  if (barcodes.length > 0) {
  alert(barcodes.map(barcode => barcode.rawValue));
  }
  setTimeout(vamos, 160);
  //window.requestAnimationFrame(vamos);
};
vamos();
};

main();
  
</script>
